{% extends 'base.html' %}

{% block title %}Book Appointment{% endblock %}

{% block content %}
    <h1>Book an Appointment</h1>
    
    {% if has_active_booking %}
    <!-- Alert for Active Booking Warning -->
    <div id="active-booking-alert" class="alert alert-danger" role="alert">
        You have an active booking. Please complete or cancel your existing booking before scheduling a new one.
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="appointment-form">
        {% csrf_token %}
    <form method="post" enctype="multipart/form-data" class="appointment-form">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="{{ form.user_name.id_for_label }}">User Name:</label>
            <input type="text" id="{{ form.user_name.id_for_label }}" name="{{ form.user_name.name }}" value="{{ request.user.username }}" readonly class="form-control">
        </div>
        
        <div class="form-group">
            <label for="{{ form.vehicle_model.id_for_label }}">Vehicle Model:</label>
            <input type="text" id="{{ form.vehicle_model.id_for_label }}" name="{{ form.vehicle_model.name }}" value="{{ form.vehicle_model.value }}" class="form-control">
        </div>
        
        <div class="form-group">
            <label for="{{ form.build_year.id_for_label }}">Build Year:</label>
            <input type="number" id="{{ form.build_year.id_for_label }}" name="{{ form.build_year.name }}" value="{{ form.build_year.value }}" class="form-control">
        </div>
        
        
        <div class="form-group">
            <label for="{{ form.registration_number.id_for_label }}">Registration Number:</label>
            <input type="text" id="{{ form.registration_number.id_for_label }}" name="{{ form.registration_number.name }}" value="{{ form.registration_number.value }}" class="form-control">
        </div>
        
        <div class="form-group">
            <label for="{{ form.service_date.id_for_label }}">Service Date:</label>
            <input type="date" id="{{ form.service_date.id_for_label }}" name="{{ form.service_date.name }}" class="form-control" min="{{ today }}" max="{{ maxDate }}">
        </div>
        

        <div class="form-group">
            <label for="{{ form.service_type.id_for_label }}">Service Type:</label>
            <select id="{{ form.service_type.id_for_label }}" name="{{ form.service_type.name }}" class="form-control">
                {% for service in service_types %}
                    <option value="{{ service.id }}">{{ service.service_name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <button type="submit" class="btn btn-primary">Book Appointment</button>

        <script>
            // Calculate today's date in the format "YYYY-MM-DD"
            var today = new Date().toISOString().split('T')[0];

            // Calculate the max date (one week from today) in the format "YYYY-MM-DD"
            var maxDate = new Date();
            maxDate.setDate(maxDate.getDate() + 7);
            var maxDateFormatted = maxDate.toISOString().split('T')[0];

            // Set the min and max attributes of the date input field
            document.getElementById("{{ form.service_date.id_for_label }}").setAttribute("min", today);
            document.getElementById("{{ form.service_date.id_for_label }}").setAttribute("max", maxDateFormatted);

            // Automatically remove the alert after 3 seconds
            setTimeout(function() {
            var alertElement = document.getElementById("active-booking-alert");
            if (alertElement) {
                alertElement.style.display = "none";
            }
        }, 3000); // 3000 milliseconds = 3 seconds
            
        </script>

    </form>
    
{% endblock %}
