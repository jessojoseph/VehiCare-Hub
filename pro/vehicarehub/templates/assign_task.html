{% extends "base.html" %}

{% block content %}
<h1>Assign Task</h1>
<form method="post">
    {% csrf_token %}

    <!-- Select Worker -->
    <div class="form-group">
        <label for="worker">Select Worker:</label>
        <select class="form-control" id="worker" name="worker_id">
            <option value="">-- Select Worker --</option>
            {% for worker in workers %}
                <option value="{{ worker.id }}">{{ worker.user.username }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Select Appointment -->
    <div class="form-group">
        <label for="appointment">Select Appointment:</label>
        <select class="form-control" id="appointment" name="appointment_id">
            <option value="">-- Select Appointment --</option>
            {% for appointment in appointments %}
                <option value="{{ appointment.id }}">{{ appointment.user_name.username }} - {{ appointment.service_date }} {{ appointment.service_time }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label for="deadline">Task Deadline:</label>
        <input type="datetime-local" class="form-control" id="deadline" name="deadline" required>
    </div>

    <button type="submit" class="btn btn-primary">Assign Task</button>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {
    // Get the current date
    var today = new Date();

    // Calculate the date 5 days from today
    var fiveDaysLater = new Date();
    fiveDaysLater.setDate(today.getDate() + 5);

    // Convert the dates to a format compatible with datetime-local input
    var todayFormatted = today.toISOString().slice(0, 16);
    var fiveDaysLaterFormatted = fiveDaysLater.toISOString().slice(0, 16);

    // Set the minimum and maximum attributes for the datetime-local input
    $('#deadline').attr('min', todayFormatted);
    $('#deadline').attr('max', fiveDaysLaterFormatted);

    // Allow time selection only from 8 am to 7 pm
    $('#deadline').on('change', function () {
        var selectedTime = new Date($('#deadline').val()).getHours();
        if (selectedTime < 8 || selectedTime >= 19) {
            $('#deadline')[0].setCustomValidity("Please select a time between 8 am and 7 pm.");
        } else {
            $('#deadline')[0].setCustomValidity('');
        }
    });
});
</script>

{% endblock %}
