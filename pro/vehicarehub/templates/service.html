{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>VehiCare Hub</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;600;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"> 

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="{% static 'lib/animate/animate.min.css' %}" rel="stylesheet">
    <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css' %}" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-grow text-primary" role="status"></div>
    </div>
    <!-- Spinner End -->

    <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top px-4 px-lg-5">
        <a href="index.html" class="navbar-brand d-flex align-items-center">
            <h1 class="m-0"><img class="img-fluid me-3" src="{% static 'images/icon/icon-02-primary.png' %}" alt=""></h1>
        </a>
        <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav mx-auto bg-light pe-4 py-3 py-lg-0">
                <a href="{% url 'index' %}" class="nav-item nav-link active">Home</a>
                
                <!-- Add this part for the user's name and logout link -->
                {% if user.is_authenticated %}
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Welcome, {{ user.username }}</a>
                        <div class="dropdown-menu bg-light border-0 m-0">
                            <a href="{% url 'logout' %}?next={% url 'index' %}" class="dropdown-item">Logout</a>
                        </div>
                    </div>
                {% else %}
                    <a href="{% url 'login' %}" class="nav-item nav-link">Login</a>
                {% endif %}
                <!-- End of added part -->
            </div>
            
        </div>
    </nav>

    {% if user.is_staff %}
<!-- Display "Add Service" button for admin users -->
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12 d-flex justify-content-end">
            <a href="{% url 'add-service' %}" class="btn btn-success mt-4">Add Service</a>
        </div>
    </div>
</div>

{% endif %}

<div class="mx-auto" style="width: 100%; max-width: 600px; height: 50px">
    <form id="search-form">
        <div class="input-group" style="height: 50px">
            <input class="form-control border-success w-50" type="text" id="query" name="query" placeholder="Search by Service Name or Cost">
            <button type="submit" id= "sub" class="btn btn-success border-0 w-25">Search</button>
        </div>
    </form>
</div>

<div class="container" style="max-width: 1700px; margin-top: 70px;" id="results">
    <!-- Results will be displayed here -->
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Define a function to handle form submission
    function handleFormSubmission() {
        // Get search query from form
        var query = $("#query").val();
        console.log("Form submitted!");
        console.log("Query:", query);

        // Send AJAX request to your Django view
        $.ajax({
            type: "GET",
            url: "/search_services/",  // Replace with the actual URL of your view
            data: { query: query },
            dataType: "json",
            success: function (data) {
                // Check if there are any results
                if (data.services.length === 0) {
                    // No results found, display a message
                    $("#results").html("<p>No services found with the given query.</p>");
                    $("#services-listings").hide();
                } else {
                    // Results found, construct HTML for displaying services
                    var resultsHtml = '<div class="row">';

                    $.each(data.services, function (index, service) {
                        resultsHtml += '<div class="col-md-4">';
                        resultsHtml += '<div class="card mb-4">';
                        resultsHtml += '<img class="card-img-top" src="' + service.image + '" alt="Service Image">';
                        resultsHtml += '<div class="card-body">';
                        resultsHtml += '<h5 class="card-title">' + service.name + '</h5>';
                        resultsHtml += '<p class="card-text"><strong>Cost:</strong> $' + service.cost + '</p>';
                        {% comment %} resultsHtml += '<a href="/vehiapp/viewservice/' + service.id + '/" class="btn btn-primary">View Service</a>'; {% endcomment %}
                        resultsHtml += '</div>';
                        resultsHtml += '</div>';
                        resultsHtml += '</div>';
                    });

                    resultsHtml += '</div>';
                    $("#results").html(resultsHtml);
                    $("#services-listings").hide();
                }
            },
            error: function (xhr, status, error) {
                // Log any errors to the console
                console.error(xhr.responseText);
            },
        });
    }

    // Call the form submission handler function when the document is ready
    $(document).ready(function () {
        $("#search-form").submit(function (e) {
            e.preventDefault();
            handleFormSubmission();
        });
    });
</script>

    <div class="container">
        <div class="row" id = "services-listings">
            
            {% for ser in ser %}
            
            <div class="col-md-4">
                <a href="{% url 'viewservice' ser.id %}">
                <div class="card mb-4">
                    <img class="card-img-top" src="{{ ser.service_image.url }}" alt="Service Image" style="height: 250px; object-fit: cover; width: 100%;">
                    <div class="card-body">
                        <h5 class="card-title">{{ ser.service_name }}</h5>
                        <!-- <p class="card-text">{{ ser.service_description }}</p> -->
                        <p class="card-text"><strong>Cost:</strong> ${{ ser.service_cost }}</p>
                        {% comment %} <a href="{% url 'service_view' ser.id %}" class="btn btn-primary">View Details</a> {% endcomment %}

    
                        {% if user.is_staff %}
                        <!-- Display Update and Delete buttons for admin users -->
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'update_service' ser.id %}" class="btn btn-primary" style="margin-right: 230px;">Update</a>
                            <form action="{% url 'delete_service' ser.id %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </a>
            </div>
        
            {% endfor %}
        </div>
    </div>
    
    <!-- Footer Start -->
    <div class="container-fluid bg-dark footer mt-5 pt-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-md-6">
                    <h1 class="text-white mb-4"><img class="img-fluid me-3" src="{% static 'images/icon/icon-02-pimary.png' %}" alt="">VehiCar Hub</h1>
                    <span>Diam dolor diam ipsum sit. Aliqu diam amet diam et eos. Clita erat ipsum et lorem et sit, sed stet lorem sit clita. Diam dolor diam ipsum sit. Aliqu diam amet diam et eos. Clita erat ipsum et lorem et sit.</span>
                </div>
                <div class="col-md-6">
                    <h5 class="text-light mb-4">Newsletter</h5>
                    <p>Clita erat ipsum et lorem et sit, sed stet lorem sit clita.</p>
                    <div class="position-relative">
                        <input class="form-control bg-transparent w-100 py-3 ps-4 pe-5" type="text" placeholder="Your email">
                        <button type="button" class="btn btn-primary py-2 px-3 position-absolute top-0 end-0 mt-2 me-2">SignUp</button>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-light mb-4">Get In Touch</h5>
                    <p><i class="fa fa-map-marker-alt me-3"></i>123 Street, New York, USA</p>
                    <p><i class="fa fa-phone-alt me-3"></i>+012 345 67890</p>
                    <p><i class="fa fa-envelope me-3"></i>vehicare@gmail.com</p>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-light mb-4">Our Services</h5>
                    <a class="btn btn-link" href="">Installations</a>
                    <a class="btn btn-link" href="">Engine Services</a>
                    <a class="btn btn-link" href="">Water Services</a>
                    <a class="btn btn-link" href="">Annual Inspections</a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-light mb-4">Quick Links</h5>
                    <a class="btn btn-link" href="">About Us</a>
                    <a class="btn btn-link" href="">Contact Us</a>
                    <a class="btn btn-link" href="">Our Services</a>
                    <a class="btn btn-link" href="">Terms & Condition</a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-light mb-4">Follow Us</h5>
                    <div class="d-flex">
                        <a class="btn btn-square rounded-circle me-1" href=""><i class="fab fa-twitter"></i></a>
                        <a class="btn btn-square rounded-circle me-1" href=""><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-square rounded-circle me-1" href=""><i class="fab fa-youtube"></i></a>
                        <a class="btn btn-square rounded-circle me-1" href=""><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid copyright">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        &copy; <a href="#">VehiCare Hub</a>, All Right Reserved.
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
                        Designed By <a href="https://htmlcodex.com">HTML Codex</a>  Distributed by <a href="https://themewagon.com">ThemeWagon</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square rounded-circle back-to-top"><i class="bi bi-arrow-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'lib/wow/wow.min.js' %}"></script>
    <script src="{% static 'lib/easing/easing.min.js' %}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
    <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>
    <script src="{% static 'lib/counterup/counterup.min.js' %}"></script>
    <script src="{% static 'lib/parallax/parallax.min.js' %}"></script>

    <!-- Template Javascript -->
    <script src="{% static 'js/main.js' %}"></script>
</body>

</html>